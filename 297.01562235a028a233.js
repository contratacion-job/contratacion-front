"use strict";(self.webpackChunkfuse=self.webpackChunkfuse||[]).push([[297],{8297:(ct,P,n)=>{n.d(P,{M:()=>st});var x=n(3566),b=n(1476),A=n(5313),i=n(6223),w=n(9773),y=n(3620),O=n(5228),u=n(6814),U=n(2296),E=n(6007),F=n(617),C=n(4170),q=n(4516),I=n(8525),Z=n(7988),S=n(6385),v=n(2246),M=n(8645),k=n(2596),N=n(1388),L=n(5520),t=n(9212),J=n(5170),R=n(7700),Q=n(3680);function W(r,l){1&r&&(t.TgZ(0,"div",28),t._UZ(1,"mat-progress-bar",29),t.qZA()),2&r&&(t.xp6(1),t.Q6J("mode","indeterminate"))}function j(r,l){if(1&r&&(t.TgZ(0,"mat-option",57),t._uU(1),t.qZA()),2&r){const o=l.$implicit;t.Q6J("value",o.id),t.xp6(1),t.Oqu(o.nombre)}}function B(r,l){if(1&r&&(t.TgZ(0,"mat-option",57),t._uU(1),t.qZA()),2&r){const o=l.$implicit;t.Q6J("value",o.id),t.xp6(1),t.Oqu(o.nombre_tipo_contrato)}}function V(r,l){if(1&r&&(t.TgZ(0,"mat-option",57),t._uU(1),t.qZA()),2&r){const o=l.$implicit;t.Q6J("value",o.id),t.xp6(1),t.Oqu(o.nombre_departamento)}}function K(r,l){if(1&r&&(t.TgZ(0,"mat-option",57),t._uU(1),t.qZA()),2&r){const o=l.$implicit;t.Q6J("value",o.id),t.xp6(1),t.Oqu(o.vigencia)}}function z(r,l){1&r&&t.GkF(0)}const Y=r=>({$implicit:r});function $(r,l){if(1&r&&(t.TgZ(0,"div",67),t.YNc(1,z,1,0,"ng-container",68),t.qZA()),2&r){const o=t.oxw().$implicit;t.oxw(2);const e=t.MAs(70);t.xp6(1),t.Q6J("ngTemplateOutlet",e)("ngTemplateOutletContext",t.VKq(2,Y,o))}}const G=(r,l,o)=>({"bg-green-500":r,"bg-orange-500":l,"bg-red-500":o});function H(r,l){if(1&r){const o=t.EpF();t.ynx(0),t.TgZ(1,"div",58)(2,"div"),t._UZ(3,"span",59),t.qZA(),t.TgZ(4,"div",60),t._uU(5),t.qZA(),t.TgZ(6,"div",61),t._uU(7),t.qZA(),t.TgZ(8,"div",61),t._uU(9),t.qZA(),t.TgZ(10,"div",61),t._uU(11),t.qZA(),t.TgZ(12,"div",60),t._uU(13),t.ALo(14,"currency"),t.qZA(),t.TgZ(15,"div",60),t._uU(16),t.ALo(17,"currency"),t.qZA(),t.TgZ(18,"div",60),t._uU(19),t.ALo(20,"date"),t.qZA(),t.TgZ(21,"div",60),t._uU(22),t.ALo(23,"date"),t.qZA(),t.TgZ(24,"div",60),t._uU(25),t.qZA(),t.TgZ(26,"div",62),t._uU(27),t.qZA(),t.TgZ(28,"div",63)(29,"button",64),t.NdJ("click",function(){const c=t.CHM(o).$implicit,s=t.oxw(2);return t.KtG(s.toggleDetails(c.id))}),t._UZ(30,"mat-icon",65),t.qZA()()(),t.YNc(31,$,2,4,"div",66),t.BQk()}if(2&r){const o=l.$implicit,e=t.oxw(2);t.xp6(3),t.Q6J("ngClass",t.kEZ(32,G,"Activo"===o.estado,"Casi a vencer"===o.estado,"Vencido"===o.estado)),t.xp6(2),t.Oqu(o.no_contrato),t.xp6(1),t.Q6J("matTooltip",o.proveedor.nombre),t.xp6(1),t.hij(" ",o.proveedor.nombre," "),t.xp6(1),t.Q6J("matTooltip",null==o.tipo_contrato?null:o.tipo_contrato.nombre_tipo_contrato),t.xp6(1),t.hij(" ",null==o.tipo_contrato?null:o.tipo_contrato.nombre_tipo_contrato," "),t.xp6(1),t.Q6J("matTooltip",null==o.departamento?null:o.departamento.nombre_departamento),t.xp6(1),t.hij(" ",null==o.departamento?null:o.departamento.nombre_departamento," "),t.xp6(2),t.hij(" ",t.gM2(14,16,o.valor_cup,"CUP","symbol","1.0-0")," "),t.xp6(3),t.hij(" ",t.gM2(17,21,o.valor_usd,"USD","symbol","1.0-0")," "),t.xp6(3),t.hij(" ",t.xi3(20,26,o.fecha_entrada,"d/M/yy")," "),t.xp6(3),t.hij(" ",t.xi3(23,29,o.fecha_firmado,"d/M/yy")," "),t.xp6(3),t.hij(" ",o.vigencia.vigencia," "),t.xp6(2),t.hij(" ",o.tiempoRestante," "),t.xp6(3),t.Q6J("svgIcon",(null==e.selectedContrato?null:e.selectedContrato.id)===o.id?"heroicons_solid:chevron-up":"heroicons_solid:chevron-down"),t.xp6(1),t.Q6J("ngIf",(null==e.selectedContrato?null:e.selectedContrato.id)===o.id)}}const X=r=>({"pointer-events-none":r}),tt=()=>[5,10,25,100];function ot(r,l){if(1&r){const o=t.EpF();t.ynx(0),t.TgZ(1,"div",30)(2,"div",31),t._UZ(3,"div"),t.TgZ(4,"div",32),t._uU(5,"No. Contrato"),t.qZA(),t.TgZ(6,"div",32),t._uU(7,"Proveedor"),t.qZA(),t.TgZ(8,"div",32),t._uU(9,"Tipo de Contrato"),t.qZA(),t.TgZ(10,"div",32),t._uU(11,"Departamento"),t.qZA(),t.TgZ(12,"div",32),t._uU(13,"Valor (CUP)"),t.qZA(),t.TgZ(14,"div",32),t._uU(15,"Valor (USD)"),t.qZA(),t.TgZ(16,"div",32),t._uU(17,"Fecha Entrada"),t.qZA(),t.TgZ(18,"div",32),t._uU(19,"Fecha Firmado"),t.qZA(),t.TgZ(20,"div",32),t._uU(21,"Vigencia"),t.qZA(),t.TgZ(22,"div",32),t._uU(23,"Tiempo Restante"),t.qZA(),t.TgZ(24,"div",33),t._uU(25,"Detalles"),t.qZA()(),t.TgZ(26,"div",34),t._UZ(27,"div"),t.TgZ(28,"div")(29,"mat-form-field",35),t._UZ(30,"input",36),t.qZA()(),t.TgZ(31,"div")(32,"mat-form-field",35)(33,"mat-select",37)(34,"mat-option",38),t._uU(35,"Todos"),t.qZA(),t.YNc(36,j,2,2,"mat-option",39),t.qZA()()(),t.TgZ(37,"div")(38,"mat-form-field",35)(39,"mat-select",40)(40,"mat-option",38),t._uU(41,"Todos"),t.qZA(),t.YNc(42,B,2,2,"mat-option",39),t.qZA()()(),t.TgZ(43,"div")(44,"mat-form-field",35)(45,"mat-select",41)(46,"mat-option",38),t._uU(47,"Todos"),t.qZA(),t.YNc(48,V,2,2,"mat-option",39),t.qZA()()(),t.TgZ(49,"div")(50,"mat-form-field",35),t._UZ(51,"input",42),t.qZA()(),t.TgZ(52,"div")(53,"mat-form-field",35),t._UZ(54,"input",43),t.qZA()(),t.TgZ(55,"div")(56,"mat-form-field",35),t._UZ(57,"input",44),t.qZA()(),t.TgZ(58,"div")(59,"mat-form-field",35),t._UZ(60,"input",45),t.qZA()(),t.TgZ(61,"div")(62,"mat-form-field",35)(63,"mat-select",46)(64,"mat-option",38),t._uU(65,"Todos"),t.qZA(),t.YNc(66,K,2,2,"mat-option",39),t.qZA()()(),t.TgZ(67,"div")(68,"mat-form-field",35)(69,"mat-select",47)(70,"mat-option",38),t._uU(71,"Todos"),t.qZA(),t.TgZ(72,"mat-option",48),t._uU(73,"Activo"),t.qZA(),t.TgZ(74,"mat-option",49),t._uU(75,"Casi a vencer"),t.qZA(),t.TgZ(76,"mat-option",50),t._uU(77,"Vencido"),t.qZA()()()(),t.TgZ(78,"div",51)(79,"button",52),t.NdJ("click",function(){t.CHM(o);const a=t.oxw();return t.KtG(a.applyFilters())}),t.TgZ(80,"mat-icon",53),t._uU(81,"search"),t.qZA()(),t.TgZ(82,"button",54),t.NdJ("click",function(){t.CHM(o);const a=t.oxw();return t.KtG(a.clearFilters())}),t.TgZ(83,"mat-icon",53),t._uU(84,"clear"),t.qZA()()()(),t.YNc(85,H,32,36,"ng-container",55),t.qZA(),t._UZ(86,"mat-paginator",56),t.BQk()}if(2&r){const o=t.oxw();t.xp6(4),t.Q6J("mat-sort-header","no_contrato"),t.xp6(2),t.Q6J("mat-sort-header","proveedor"),t.xp6(2),t.Q6J("mat-sort-header","tipo_contrato"),t.xp6(2),t.Q6J("mat-sort-header","departamento"),t.xp6(2),t.Q6J("mat-sort-header","valor_cup"),t.xp6(2),t.Q6J("mat-sort-header","valor_usd"),t.xp6(2),t.Q6J("mat-sort-header","fecha_entrada"),t.xp6(2),t.Q6J("mat-sort-header","fecha_firmado"),t.xp6(2),t.Q6J("mat-sort-header","vigencia"),t.xp6(2),t.Q6J("mat-sort-header","tiempoRestante"),t.xp6(4),t.Q6J("formGroup",o.filterForm),t.xp6(10),t.Q6J("ngForOf",o.proveedores),t.xp6(6),t.Q6J("ngForOf",o.tiposContrato),t.xp6(6),t.Q6J("ngForOf",o.departamentos),t.xp6(18),t.Q6J("ngForOf",o.vigencias),t.xp6(19),t.Q6J("ngForOf",o.dataSource.filteredData)("ngForTrackBy",o.trackByFn),t.xp6(1),t.Q6J("ngClass",t.VKq(23,X,o.isLoading))("length",o.pagination.length)("pageIndex",o.pagination.page)("pageSize",o.pagination.size)("pageSizeOptions",t.DdM(25,tt))("showFirstLastButtons",!0)}}function et(r,l){if(1&r&&(t.TgZ(0,"mat-option",57),t._uU(1),t.qZA()),2&r){const o=l.$implicit;t.Q6J("value",o),t.xp6(1),t.hij(" ",o.nombre," ")}}function at(r,l){if(1&r&&(t.TgZ(0,"mat-option",57),t._uU(1),t.qZA()),2&r){const o=l.$implicit;t.Q6J("value",o),t.xp6(1),t.hij(" ",o.tipo_contrato," ")}}function rt(r,l){if(1&r&&(t.TgZ(0,"mat-option",57),t._uU(1),t.qZA()),2&r){const o=l.$implicit;t.Q6J("value",o),t.xp6(1),t.hij(" ",o.nombre_departamento," ")}}function it(r,l){if(1&r&&(t.TgZ(0,"mat-option",57),t._uU(1),t.qZA()),2&r){const o=l.$implicit;t.Q6J("value",o),t.xp6(1),t.hij(" ",o.vigencia," ")}}function nt(r,l){if(1&r){const o=t.EpF();t.TgZ(0,"div",69)(1,"div",70)(2,"form",71)(3,"div",72)(4,"div",73)(5,"mat-form-field",74)(6,"mat-label"),t._uU(7,"No. Contrato"),t.qZA(),t._UZ(8,"input",75),t.qZA(),t.TgZ(9,"mat-form-field",74)(10,"mat-label"),t._uU(11,"Proveedor"),t.qZA(),t.TgZ(12,"mat-select",76),t.YNc(13,et,2,2,"mat-option",39),t.qZA()(),t.TgZ(14,"mat-form-field",74)(15,"mat-label"),t._uU(16,"Tipo de Contrato"),t.qZA(),t.TgZ(17,"mat-select",77),t.YNc(18,at,2,2,"mat-option",39),t.qZA()(),t.TgZ(19,"mat-form-field",74)(20,"mat-label"),t._uU(21,"Departamento"),t.qZA(),t.TgZ(22,"mat-select",78),t.YNc(23,rt,2,2,"mat-option",39),t.qZA()(),t.TgZ(24,"mat-form-field",74)(25,"mat-label"),t._uU(26,"No. Comit\xe9 Contrataci\xf3n"),t.qZA(),t._UZ(27,"input",79),t.qZA(),t.TgZ(28,"mat-form-field",74)(29,"mat-label"),t._uU(30,"Fecha Acuerdo Comit\xe9 Contrataci\xf3n"),t.qZA(),t._UZ(31,"input",80),t.qZA()(),t.TgZ(32,"div",73)(33,"mat-form-field",74)(34,"mat-label"),t._uU(35,"Valor (CUP)"),t.qZA(),t.TgZ(36,"span",81),t._uU(37,"CUP"),t.qZA(),t._UZ(38,"input",82),t.qZA(),t.TgZ(39,"mat-form-field",74)(40,"mat-label"),t._uU(41,"Valor (USD)"),t.qZA(),t.TgZ(42,"span",81),t._uU(43,"$"),t.qZA(),t._UZ(44,"input",83),t.qZA(),t.TgZ(45,"mat-form-field",74)(46,"mat-label"),t._uU(47,"Fecha Firmado"),t.qZA(),t._UZ(48,"input",84),t.qZA(),t.TgZ(49,"mat-form-field",74)(50,"mat-label"),t._uU(51,"Fecha Comit\xe9 Contrataci\xf3n"),t.qZA(),t._UZ(52,"input",85),t.qZA(),t.TgZ(53,"mat-form-field",74)(54,"mat-label"),t._uU(55,"No. Acuerdo Comit\xe9 Contrataci\xf3n"),t.qZA(),t._UZ(56,"input",86),t.qZA(),t.TgZ(57,"mat-form-field",74)(58,"mat-label"),t._uU(59,"Fecha Comit\xe9 Administraci\xf3n"),t.qZA(),t._UZ(60,"input",87),t.qZA()(),t.TgZ(61,"div",73)(62,"mat-form-field",74)(63,"mat-label"),t._uU(64,"Vigencia"),t.qZA(),t.TgZ(65,"mat-select",88),t.YNc(66,it,2,2,"mat-option",39),t.qZA()(),t.TgZ(67,"mat-form-field",74)(68,"mat-label"),t._uU(69,"Observaciones"),t.qZA(),t._UZ(70,"textarea",89),t.qZA(),t.TgZ(71,"mat-form-field",74)(72,"mat-label"),t._uU(73,"Fecha Entrada"),t.qZA(),t._UZ(74,"input",90),t.qZA(),t.TgZ(75,"mat-form-field",74)(76,"mat-label"),t._uU(77,"Estado"),t.qZA(),t.TgZ(78,"mat-select",91)(79,"mat-option",48),t._uU(80,"Activo"),t.qZA(),t.TgZ(81,"mat-option",49),t._uU(82,"Casi a vencer"),t.qZA(),t.TgZ(83,"mat-option",50),t._uU(84,"Vencido"),t.qZA()()(),t.TgZ(85,"mat-form-field",74)(86,"mat-label"),t._uU(87,"No. Comit\xe9 Administraci\xf3n"),t.qZA(),t._UZ(88,"input",92),t.qZA()()(),t.TgZ(89,"div",93)(90,"button",94),t.NdJ("click",function(){t.CHM(o);const a=t.oxw();return t.KtG(a.updateSelectedContrato())}),t._uU(91," Actualizar "),t.qZA(),t.TgZ(92,"button",94),t.NdJ("click",function(){t.CHM(o);const a=t.oxw();return t.KtG(a.deleteSelectedContrato())}),t._uU(93," Eliminar "),t.qZA()()()()()}if(2&r){const o=t.oxw();t.xp6(2),t.Q6J("formGroup",o.selectedContratoForm),t.xp6(11),t.Q6J("ngForOf",o.proveedores),t.xp6(5),t.Q6J("ngForOf",o.tiposContrato),t.xp6(5),t.Q6J("ngForOf",o.mockDepartamento),t.xp6(43),t.Q6J("ngForOf",o.vigencias),t.xp6(24),t.Q6J("color","primary"),t.xp6(2),t.Q6J("color","warn")}}function lt(r,l){1&r&&(t.TgZ(0,"div",95),t._uU(1," \xa1No hay contratos! "),t.qZA())}let st=(()=>{class r{constructor(o,e,a,c){this.contratoService=o,this.dialog=e,this.cdr=a,this.fb=c,this.data=[],this.proveedores=[],this.tiposContrato=[],this.vigencias=[],this.departamentos=v.iy,this.estados=[{label:"Activo",color:"green"},{label:"Casi a vencer",color:"orange"},{label:"Vencido",color:"red"}],this.montoInicialCup=8e3,this.totalEjecutadoCup=6e3,this.montoRestanteCup=2e3,this.montoInicialUsd="-",this.totalEjecutadoUsd="-",this.montoRestanteUsd="-",this._unsubscribeAll=new M.x,this.columns=[{key:"no_contrato",label:"No. Contrato",sortable:!0},{key:"proveedor",label:"Proveedor",sortable:!0},{key:"tipo_contrato",label:"Tipo de Contrato",sortable:!0},{key:"departamento",label:"Departamento",sortable:!0},{key:"valor_cup",label:"Valor (CUP)",sortable:!0},{key:"valor_usd",label:"Valor (USD)",sortable:!0},{key:"fecha_entrada",label:"Fecha Entrada",sortable:!0},{key:"fecha_firmado",label:"Fecha Firmado",sortable:!0},{key:"vigencia",label:"Vigencia",sortable:!0}],this.showAddForm=!1,this.isAdding=!1,this.isLoading=!1,this.searchInputControl=new i.p4,this.dataSource=new A.by([]),this.noContracts=null,this.displayedColumns=["estado","no_contrato","proveedor","tipo_contrato","departamento","valor_cup","valor_usd","fecha_entrada","fecha_firmado","vigencia","details"],this.title="Contratos",this.addButtonText="Agregar Contrato",this.selectedContrato=null,this.errorMessage="",this.pagination={length:0,page:0,size:10},this.showAdvancedFilters=!1,this.dataSource=new A.by([]),this.initSelectedContratoForm(),this.initNewContratoForm(),this.filterForm=this.fb.group({vigencia_id:[""],proveedor_id:[""],tipo_contrato_id:[""],departamento_id:[""],estado:[""],fecha_desde:[""],fecha_hasta:[""],valor_minimo:[""],valor_maximo:[""],no_contrato_filter:[""],valor_cup_filter:[""],valor_usd_filter:[""],fecha_entrada_filter:[""],fecha_firmado_filter:[""]})}toggleAdvancedFilters(){this.showAdvancedFilters=!this.showAdvancedFilters}ngOnInit(){this.proveedores=v.UB,this.tiposContrato=v.j2,this.vigencias=v.G7,this.loadContratos(),this.dataSource.sortingDataAccessor=(o,e)=>{switch(e){case"proveedor":return o.proveedor?.nombre;case"tipo_contrato":return o.tipo_contrato?.nombre_tipo_contrato;case"departamento":return o.departamento?.nombre_departamento;case"vigencia":return o.vigencia?.vigencia;case"valor_cup":return o.valor_cup||0;case"valor_usd":return o.valor_usd||0;case"fecha_entrada":return o.fecha_entrada||"";case"fecha_firmado":return o.fecha_firmado||"";default:return o[e]}},this.dataSource.filterPredicate=(o,e)=>{if(!e)return!0;const a=e.toLowerCase().trim();return[o.no_contrato?.toString()||"",o.proveedor?.nombre?.toLowerCase()||"",o.tipo_contrato?.nombre_tipo_contrato?.toLowerCase()||"",o.departamento?.nombre_departamento?.toLowerCase()||"",o.estado?.toLowerCase()||"",o.valor_cup?.toString()||"",o.valor_usd?.toString()||"",o.fecha_entrada||"",o.fecha_firmado||"",void 0!==o.vigencia?.vigencia?o.vigencia.vigencia.toString():"",o.observaciones?.toLowerCase()||"","string"==typeof o.tiempoRestante?o.tiempoRestante.toLowerCase():""].join(" ").includes(a)},this.searchInputControl.valueChanges.pipe((0,w.R)(this._unsubscribeAll),(0,y.b)(300)).subscribe(o=>{this.closeDetails(),this.dataSource.filter=o?o.trim().toLowerCase():"",this.cdr.detectChanges()}),this.filterForm.valueChanges.pipe((0,w.R)(this._unsubscribeAll),(0,y.b)(300)).subscribe(()=>{this.applyFilters()})}loadContratos(){this.isLoading=!0,this.errorMessage="",this.contratoService.getContratos().subscribe({next:o=>{const e=o.filter(a=>"Vencido"!==a.estado);e.forEach(a=>{a.tiempoRestante=this.calcularTiempoRestante(a)}),this.data=e,this.dataSource.data=e,this.pagination.length=e.length,this.isLoading=!1,this.cdr.detectChanges()},error:o=>{this.errorMessage="Error al cargar los contratos. Por favor, intente nuevamente.",this.isLoading=!1,this.cdr.detectChanges()}})}applyFilters(){const o=this.filterForm.value;let e=this.dataSource.data;o.proveedor_id&&(e=e.filter(a=>a.proveedor.id===o.proveedor_id)),o.tipo_contrato_id&&(e=e.filter(a=>a.tipo_contrato?.id===o.tipo_contrato_id)),o.departamento_id&&(e=e.filter(a=>a.departamento?.id===o.departamento_id)),o.valor_cup_filter&&(e=e.filter(a=>a.valor_cup>=o.valor_cup_filter)),o.valor_usd_filter&&(e=e.filter(a=>a.valor_usd>=o.valor_usd_filter)),o.fecha_entrada_filter&&(e=e.filter(a=>new Date(a.fecha_entrada)>=new Date(o.fecha_entrada_filter))),o.fecha_firmado_filter&&(e=e.filter(a=>new Date(a.fecha_firmado)>=new Date(o.fecha_firmado_filter))),o.vigencia_id&&(e=e.filter(a=>a.vigencia.id===o.vigencia_id)),o.estado&&(e=e.filter(a=>a.estado===o.estado)),this.dataSource.filteredData=e}clearFilters(){this.filterForm.reset(),this.dataSource.filteredData=this.dataSource.data}initSelectedContratoForm(){this.selectedContratoForm=this.fb.group({no_contrato:["",i.kI.required],proveedor:[null,i.kI.required],tipo_contrato:[null,i.kI.required],departamento:[null,i.kI.required],no_comite_contratacion:["",i.kI.required],fecha_comite_contratacion:["",i.kI.required],no_acuerdo_comite_contratacion:["",i.kI.required],fecha_acuerdo_comite_contratacion:["",i.kI.required],no_comite_administracion:["",i.kI.required],fecha_comite_administracion:["",i.kI.required],estado:["",i.kI.required],valor_cup:[0,[i.kI.required,i.kI.min(0)]],valor_usd:[0,[i.kI.min(0)]],fecha_firmado:["",i.kI.required],vigencia:[null,i.kI.required],observaciones:[""],fecha_vencido:[""]})}ngAfterViewInit(){this.dataSource.paginator=this.paginator,this.paginator&&(this.paginator.pageSize=10,this.paginator.pageSizeOptions=[5,10,25,50]),this.dataSource.sort=this.sort,this.sort&&(this.sort.active="no_contrato",this.sort.direction="asc"),this.cdr.detectChanges()}calcularTiempoRestante(o){const e=new Date;let a=null;if(o.fecha_vencido?a=new Date(o.fecha_vencido):o.fecha_firmado&&o.vigencia&&o.vigencia.vigencia&&(a=new Date(o.fecha_firmado),a.setDate(a.getDate()+o.vigencia.vigencia)),!a)return"N/A";const c=a.getTime()-e.getTime();if(c<0)return"Vencido";let s=c;const p=31536e6,d=2592e6,f=6048e5,m=Math.floor(s/p);s-=m*p;const h=Math.floor(s/d);s-=h*d;const T=Math.floor(s/f);s-=T*f;const D=Math.floor(s/864e5);let _="";return m>0&&(_+=m+(1===m?" a\xf1o":" a\xf1os")),h>0&&(_.length>0&&(_+=", "),_+=h+(1===h?" mes":" meses")),T>0&&(_.length>0&&(_+=", "),_+=T+(1===T?" semana":" semanas")),D>0&&(_.length>0&&(_+=" y "),_+=D+(1===D?" d\xeda":" d\xedas")),_||"Menos de un d\xeda"}trackByFn(o,e){return e.id}getNestedValue(o,e,a){return a&&o[e]?o[e][a]:o[e]||""}toggleDetails(o){this.selectedContrato?.id===o?this.selectedContrato=null:(this.selectedContrato=this.data.find(e=>e.id===o)||null,this.selectedContrato&&(this.selectedContratoForm||this.initNewContratoForm(),this.selectedContratoForm.patchValue({no_contrato:this.selectedContrato.no_contrato||"",proveedor:this.selectedContrato.proveedor||null,tipo_contrato:this.selectedContrato.tipo_contrato||null,valor_cup:this.selectedContrato.valor_cup||0,valor_usd:this.selectedContrato.valor_usd||0,fecha_firmado:this.selectedContrato.fecha_firmado||"",vigencia:this.selectedContrato.vigencia||null,observaciones:this.selectedContrato.observaciones||"",fecha_vencido:this.selectedContrato.fecha_vencido||""}))),this.cdr.detectChanges()}closeDetails(){this.selectedContrato=null}openNewContratoDialog(){const o=window.innerWidth<=768;this.dialog.open(O._,{width:o?"90vw":"750px",maxWidth:o?"100vw":"90vw",height:o?"100vh":"90vh",maxHeight:"100vh",panelClass:"full-screen-dialog",disableClose:!1,autoFocus:!1,hasBackdrop:!o,position:o?{top:"0"}:{}}).afterClosed().subscribe(a=>{a&&this.loadContratos()})}initNewContratoForm(){this.newContratoForm=this.fb.group({no_contrato:["",i.kI.required],proveedor:[null,i.kI.required],tipo_contrato:[null,i.kI.required],valor_cup:[0,[i.kI.required,i.kI.min(0)]],valor_usd:[0,[i.kI.min(0)]],fecha_firmado:["",i.kI.required],vigencia:[null,i.kI.required],observaciones:[""],fecha_entrada:[(new Date).toISOString().split("T")[0]]})}toggleAddForm(){this.showAddForm=!this.showAddForm,this.showAddForm||(this.newContratoForm.reset(),this.initNewContratoForm()),this.cdr.markForCheck()}cancelAdd(){this.showAddForm=!1,this.newContratoForm.reset(),this.initNewContratoForm()}addNewContrato(){if(this.newContratoForm.invalid)return void this.newContratoForm.markAllAsTouched();this.isAdding=!0;const o=this.newContratoForm.value,e={...o,id:0,estado:"Activo",departamento:v.iy[0],fecha_entrada:(new Date).toISOString().split("T")[0],fecha_vencido:this.calculateExpirationDate(o.fecha_firmado,o.vigencia.vigencia)};this.contratoService.createContrato(e).subscribe({next:()=>{this.isAdding=!1,this.showAddForm=!1,this.loadContratos(),this.newContratoForm.reset(),this.initNewContratoForm()},error:a=>{console.error("Error al crear el contrato:",a),this.isAdding=!1}})}calculateExpirationDate(o,e){if(!o||!e)return"";const a=new Date(o);return a.setDate(a.getDate()+e),a.toISOString().split("T")[0]}exportToPDF(){try{if(!this.dataSource.filteredData||0===this.dataSource.filteredData.length)return console.warn("No hay datos para exportar"),void alert("No hay datos para exportar");console.log("Iniciando exportaci\xf3n PDF...");const o=new N.ZP({orientation:"landscape",unit:"mm",format:"a4"});o.setFontSize(16),o.setTextColor(40,40,40),o.text("Reporte de Contratos",14,20),o.setFontSize(10),o.setTextColor(100,100,100),o.text(`Fecha de generaci\xf3n: ${(new Date).toLocaleDateString("es-ES")}`,14,30),o.text(`Total de contratos: ${this.dataSource.filteredData.length}`,14,35);const e=["No. Contrato","Proveedor","Tipo","Departamento","Valor CUP","Valor USD","F. Entrada","Estado"],a=this.dataSource.filteredData.map(s=>[s.no_contrato||"",this.truncateText(s.proveedor?.nombre||"",20),this.truncateText(s.tipo_contrato?.nombre_tipo_contrato||"",15),this.truncateText(s.departamento?.nombre_departamento||"",15),this.formatNumber(s.valor_cup||0),this.formatNumber(s.valor_usd||0),this.formatDateForPDF(s.fecha_entrada),s.estado||""]);console.log("Datos preparados para la tabla:",a.length,"filas"),(0,L.ZP)(o,{head:[e],body:a,startY:45,theme:"striped",styles:{fontSize:8,cellPadding:3,overflow:"linebreak",halign:"left"},headStyles:{fillColor:[41,128,185],textColor:[255,255,255],fontStyle:"bold",fontSize:9},columnStyles:{0:{cellWidth:25},1:{cellWidth:40},2:{cellWidth:30},3:{cellWidth:30},4:{cellWidth:25,halign:"right"},5:{cellWidth:25,halign:"right"},6:{cellWidth:25,halign:"center"},7:{cellWidth:20,halign:"center"}},alternateRowStyles:{fillColor:[245,245,245]},margin:{top:45,left:14,right:14,bottom:20},didDrawPage:s=>{const p=o.getNumberOfPages(),d=o.internal.pageSize,f=d.height||d.getHeight();o.setFontSize(8),o.setTextColor(100,100,100),o.text(`P\xe1gina ${s.pageNumber} de ${p}`,14,f-10);const g="Sistema de Gesti\xf3n de Contratos",m=o.getTextWidth(g),h=d.width||d.getWidth();o.text(g,h-14-m,f-10)}}),console.log("Tabla generada, guardando PDF...");const c=`contratos_export_${(new Date).toISOString().split("T")[0]}.pdf`;o.save(c),console.log("PDF guardado exitosamente")}catch(o){console.error("Error al exportar PDF:",o),alert("Error al generar el PDF. Por favor, intente nuevamente.")}}formatNumber(o){return o&&0!==o?new Intl.NumberFormat("es-ES",{minimumFractionDigits:0,maximumFractionDigits:0}).format(o):"0"}formatCurrencyForPDF(o,e){return o&&0!==o?`${e} ${new Intl.NumberFormat("es-ES",{minimumFractionDigits:0,maximumFractionDigits:0}).format(o)}`:`${e} 0`}formatDateForPDF(o){if(!o)return"";try{let e;if(o instanceof Date)e=o;else{if("string"!=typeof o)return"";e=new Date(o)}return isNaN(e.getTime())?"":e.toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"2-digit"})}catch{return""}}formatDateForCSV(o){if(!o)return"";try{let e;if(o instanceof Date)e=o;else{if("string"!=typeof o)return"";e=new Date(o)}return isNaN(e.getTime())?"":e.toLocaleDateString("es-ES")}catch{return""}}truncateText(o,e){return o?o.length<=e?o:o.substring(0,e-3)+"...":""}exportToCSV(){if(!this.dataSource.filteredData||0===this.dataSource.filteredData.length)return;const o=[];o.push(["No. Contrato","Proveedor","Tipo de Contrato","Departamento","Valor (CUP)","Valor (USD)","Fecha Entrada","Fecha Firmado","Vigencia","Tiempo Restante","Estado","Observaciones"].join(",")),this.dataSource.filteredData.forEach(d=>{const g=[d.no_contrato,d.proveedor?.nombre||"",d.tipo_contrato?.nombre_tipo_contrato||"",d.departamento?.nombre_departamento||"",d.valor_cup,d.valor_usd,d.fecha_entrada,d.fecha_firmado,d.vigencia?.vigencia,d.tiempoRestante||"",d.estado||"",d.observaciones||""].map(m=>"string"==typeof m&&(m.includes(",")||m.includes('"'))?`"${m.replace(/"/g,'""')}"`:m);o.push(g.join(","))});const a=o.join("\n"),c=new Blob([a],{type:"text/csv;charset=utf-8;"}),s=window.URL.createObjectURL(c),p=document.createElement("a");p.href=s,p.download="contratos_export.csv",p.click(),window.URL.revokeObjectURL(s)}static#t=this.\u0275fac=function(e){return new(e||r)(t.Y36(J.d),t.Y36(R.uw),t.Y36(t.sBO),t.Y36(i.qu))};static#o=this.\u0275cmp=t.Xpm({type:r,selectors:[["app-contrato-list"]],viewQuery:function(e,a){if(1&e&&(t.Gf(x.YE,5),t.Gf(b.NW,5)),2&e){let c;t.iGM(c=t.CRH())&&(a.sort=c.first),t.iGM(c=t.CRH())&&(a.paginator=c.first)}},standalone:!0,features:[t.jDz],decls:73,vars:29,consts:[[1,"flex","flex-col","min-h-screen","p-6","w-full"],[1,"relative","flex","flex-col","flex-auto","p-6","pr-3","pb-3","bg-card","rounded-2xl","shadow","overflow-hidden","mb-6","w-full"],[1,"absolute","bottom-0","right-0","w-24","h-24","-m-6"],[1,"icon-size-24","opacity-25","text-green-500","dark:text-green-400",3,"svgIcon"],[1,"flex","flex-row","flex-wrap","mt-4","-mx-6"],[1,"flex","flex-col","mx-6","my-3"],[1,"text-sm","font-medium","leading-none","text-secondary"],[1,"mt-2","font-medium","text-3xl","leading-none"],[1,"flex","flex-col","flex-auto","min-w-0","bg-card","dark:bg-transparent"],[1,"relative","flex","flex-col","sm:flex-row","flex-0","sm:items-center","sm:justify-between","py-8","px-6","md:px-8","border-b"],["class","absolute inset-x-0 bottom-0",4,"ngIf"],[1,"text-4xl","font-extrabold","tracking-tight"],[1,"flex","flex-col","sm:flex-row","shrink-0","items-center","justify-between","py-4","px-6","md:px-8","border-b"],[1,"fuse-mat-dense","fuse-mat-rounded","min-w-64",3,"subscriptSizing"],["matPrefix","",1,"icon-size-5",3,"svgIcon"],["matInput","",3,"formControl","autocomplete","placeholder"],[1,"flex","items-center","gap-4","mt-4","sm:mt-0"],["mat-flat-button","",1,"text-lg",3,"color","click"],[3,"svgIcon"],[1,"ml-2","mr-1"],["mat-icon-button","","matTooltip","Exportar tabla","aria-label","Exportar tabla",1,"ml-4","mt-4","sm:mt-0",3,"matMenuTriggerFor","color"],["exportMenu","matMenu"],["mat-menu-item","",3,"click"],[1,"flex","flex-auto","overflow-hidden"],[1,"flex","flex-col","flex-auto","sm:mb-18","overflow-x-auto"],[4,"ngIf","ngIfElse"],["rowDetailsTemplate",""],["noContracts",""],[1,"absolute","inset-x-0","bottom-0"],[3,"mode"],[1,"flex","flex-col","h-full","overflow-y-auto"],["matSort","","matSortDisableClear","",1,"inventory-grid","z-10","sticky","top-0","grid","gap-4","py-4","px-6","md:px-8","shadow","text-md","font-semibold","text-secondary","bg-gray-50","dark:bg-black","dark:bg-opacity-5",2,"grid-template-columns","40px repeat(10, minmax(100px, 1fr)) 100px"],[3,"mat-sort-header"],[1,"sticky-end"],[1,"inventory-grid","grid","gap-4","py-3","px-6","md:px-8","border-b","bg-gray-50","dark:bg-gray-800",2,"grid-template-columns","40px repeat(10, minmax(100px, 1fr)) 100px",3,"formGroup"],["appearance","outline","subscriptSizing","dynamic",1,"w-full"],["matInput","","placeholder","No. Contrato","formControlName","no_contrato_filter"],["formControlName","proveedor_id","placeholder","Proveedor"],["value",""],[3,"value",4,"ngFor","ngForOf"],["formControlName","tipo_contrato_id","placeholder","Tipo"],["formControlName","departamento_id","placeholder","Departamento"],["matInput","","type","number","placeholder","Valor CUP","formControlName","valor_cup_filter"],["matInput","","type","number","placeholder","Valor USD","formControlName","valor_usd_filter"],["matInput","","type","date","formControlName","fecha_entrada_filter"],["matInput","","type","date","formControlName","fecha_firmado_filter"],["formControlName","vigencia_id","placeholder","Vigencia"],["formControlName","estado","placeholder","Estado"],["value","Activo"],["value","Casi a vencer"],["value","Vencido"],[1,"flex","gap-1","sticky-end"],["mat-icon-button","","color","primary","type","button","matTooltip","Aplicar filtros",1,"!w-8","!h-8","!min-w-8",3,"click"],[1,"!text-sm"],["mat-icon-button","","color","warn","type","button","matTooltip","Limpiar filtros",1,"!w-8","!h-8","!min-w-8",3,"click"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"sm:absolute","sm:inset-x-0","sm:bottom-0","border-b","sm:border-t","sm:border-b-0","z-10","bg-gray-50","dark:bg-transparent",3,"ngClass","length","pageIndex","pageSize","pageSizeOptions","showFirstLastButtons"],[3,"value"],[1,"inventory-grid","grid","gap-4","py-3","px-6","md:px-8","border-b","items-center","text-m",2,"grid-template-columns","40px repeat(10, minmax(100px, 1fr)) 100px"],[1,"w-3","h-3","rounded-full","inline-block",3,"ngClass"],[1,"truncate"],["matTooltipPosition","above",1,"truncate",3,"matTooltip"],[1,"truncate","text-red-600","dark:text-sky-400"],[1,"flex","items-center","justify-center","sticky-end"],["mat-stroked-button","",1,"min-w-10","min-h-7","h-7","px-2","leading-6","whitespace-nowrap",3,"click"],[1,"icon-size-5",3,"svgIcon"],["class","grid",4,"ngIf"],[1,"grid"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"shadow-lg","overflow-hidden"],[1,"flex","border-b"],[1,"responsive-form","flex","flex-col","w-full","mx-auto","p-8",3,"formGroup"],[1,"flex","flex-auto","flex-wrap"],[1,"flex","flex-col","w-full","lg:w-1/3","sm:pl-8"],[1,"w-full"],["matInput","","formControlName","no_contrato"],["formControlName","proveedor"],["formControlName","tipo_contrato"],["formControlName","departamento"],["matInput","","formControlName","no_comite_contratacion"],["matInput","","type","date","formControlName","fecha_acuerdo_comite_contratacion"],["matPrefix",""],["matInput","","type","number","formControlName","valor_cup"],["matInput","","type","number","formControlName","valor_usd"],["matInput","","type","date","formControlName","fecha_firmado"],["matInput","","type","date","formControlName","fecha_comite_contratacion"],["matInput","","formControlName","no_acuerdo_comite_contratacion"],["matInput","","type","date","formControlName","fecha_comite_administracion"],["formControlName","vigencia"],["matInput","","formControlName","observaciones"],["matInput","","type","date","formControlName","fecha_entrada"],["formControlName","estado"],["matInput","","formControlName","no_comite_administracion"],[1,"flex","flex-col","sm:flex-row","items-center","justify-end","w-full","border-t","px-4","py-4","gap-3"],["mat-stroked-button","",1,"w-full","sm:w-auto","px-6",3,"color","click"],[1,"p-8","sm:p-16","border-b","text-4xl","font-semibold","tracking-tight","text-center"]],template:function(e,a){if(1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2),t._UZ(3,"mat-icon",3),t.qZA(),t.TgZ(4,"div",4)(5,"div",5)(6,"div",6),t._uU(7," Monto Inicial CUP "),t.qZA(),t.TgZ(8,"div",7),t._uU(9),t.ALo(10,"currency"),t.qZA()(),t.TgZ(11,"div",5)(12,"div",6),t._uU(13," Total Ejecutado CUP "),t.qZA(),t.TgZ(14,"div",7),t._uU(15),t.ALo(16,"currency"),t.qZA()(),t.TgZ(17,"div",5)(18,"div",6),t._uU(19," Monto Restante CUP "),t.qZA(),t.TgZ(20,"div",7),t._uU(21),t.ALo(22,"currency"),t.qZA()(),t.TgZ(23,"div",5)(24,"div",6),t._uU(25," Monto Inicial USD "),t.qZA(),t.TgZ(26,"div",7),t._uU(27),t.qZA()(),t.TgZ(28,"div",5)(29,"div",6),t._uU(30," Total Ejecutado USD "),t.qZA(),t.TgZ(31,"div",7),t._uU(32),t.qZA()(),t.TgZ(33,"div",5)(34,"div",6),t._uU(35," Monto Restante USD "),t.qZA(),t.TgZ(36,"div",7),t._uU(37),t.qZA()()()(),t.TgZ(38,"div",8)(39,"div",9),t.YNc(40,W,2,1,"div",10),t.TgZ(41,"div",11),t._uU(42,"Contratos"),t.qZA()(),t.TgZ(43,"div",12)(44,"mat-form-field",13),t._UZ(45,"mat-icon",14)(46,"input",15),t.qZA(),t.TgZ(47,"div",16)(48,"button",17),t.NdJ("click",function(){return a.openNewContratoDialog()}),t._UZ(49,"mat-icon",18),t.TgZ(50,"span",19),t._uU(51,"Agregar"),t.qZA()(),t.TgZ(52,"button",20),t._UZ(53,"mat-icon",18),t.qZA(),t.TgZ(54,"mat-menu",null,21)(56,"button",22),t.NdJ("click",function(){return a.exportToCSV()}),t.TgZ(57,"mat-icon"),t._uU(58,"description"),t.qZA(),t.TgZ(59,"span"),t._uU(60,"Exportar a CSV"),t.qZA()(),t.TgZ(61,"button",22),t.NdJ("click",function(){return a.exportToPDF()}),t.TgZ(62,"mat-icon"),t._uU(63,"table_chart"),t.qZA(),t.TgZ(64,"span"),t._uU(65,"Exportar a PDF"),t.qZA()()()()(),t.TgZ(66,"div",23)(67,"div",24),t.YNc(68,ot,87,26,"ng-container",25)(69,nt,94,7,"ng-template",null,26,t.W1O)(71,lt,2,0,"ng-template",null,27,t.W1O),t.qZA()()()()),2&e){const c=t.MAs(55),s=t.MAs(72);t.xp6(3),t.Q6J("svgIcon","heroicons_outline:check-circle"),t.xp6(6),t.hij(" ",t.xi3(10,20,a.montoInicialCup,"CUP")," "),t.xp6(6),t.hij(" ",t.xi3(16,23,a.totalEjecutadoCup,"CUP")," "),t.xp6(6),t.hij(" ",t.xi3(22,26,a.montoRestanteCup,"CUP")," "),t.xp6(6),t.hij(" ",a.montoInicialUsd," "),t.xp6(5),t.hij(" ",a.totalEjecutadoUsd," "),t.xp6(5),t.hij(" ",a.montoRestanteUsd," "),t.xp6(3),t.Q6J("ngIf",a.isLoading),t.xp6(4),t.Q6J("subscriptSizing","dynamic"),t.xp6(1),t.Q6J("svgIcon","heroicons_solid:magnifying-glass"),t.xp6(1),t.Q6J("formControl",a.searchInputControl)("autocomplete","off")("placeholder","Buscar contratos"),t.xp6(2),t.Q6J("color","primary"),t.xp6(1),t.Q6J("svgIcon","heroicons_outline:plus"),t.xp6(3),t.Q6J("matMenuTriggerFor",c)("color","primary"),t.xp6(1),t.Q6J("svgIcon","heroicons_outline:arrow-up-tray"),t.xp6(15),t.Q6J("ngIf",a.dataSource.data.length>0)("ngIfElse",s)}},dependencies:[u.ez,u.mk,u.sg,u.O5,u.tP,u.H9,u.uU,U.ot,U.lW,U.RK,E.Cv,E.pW,x.JX,x.YE,x.nU,A.p0,F.Ps,F.Hw,i.UX,i._Y,i.Fj,i.wV,i.JJ,i.JL,i.oH,i.sg,i.u,b.TU,b.NW,C.lN,C.KE,C.hX,C.qo,q.c,q.Nt,I.LD,I.gD,Q.ey,Z.Tx,Z.VK,Z.OP,Z.p6,k.AV,k.gM,S.t],styles:['@charset "UTF-8";.inventory-grid{display:grid;grid-template-columns:25px repeat(9,1fr) 35px;gap:1rem;width:100%;box-sizing:border-box}.add-form-container{padding:1rem;background-color:#fff;border-radius:.5rem;box-shadow:0 0 10px #0000001a;max-width:100%;margin:1rem auto;overflow:visible}@media (max-width: 640px){.add-form-container{padding:.5rem;margin:.5rem 0}}.inventory-grid.z-3{position:sticky;top:0;background:white;z-index:20;box-shadow:0 2px 5px -2px #0000001a;overflow:visible}.dark .inventory-grid.z-3{background:#1E1E1E}.inventory-grid>div:last-child{position:sticky;right:0;background:white;z-index:10;box-shadow:-2px 0 5px -2px #0000001a}.dark .inventory-grid>div:last-child{background:#0F172A}.sticky-end{position:sticky;right:0;background:white;z-index:11;box-shadow:-2px 0 5px -2px #0000001a}.dark .sticky-end{background:#0F172A}.dark .inventory-grid>div{color:#e0e0e0}.dark .sticky-end .mat-stroked-button{background:#0F172A!important;color:#fff!important;border-color:#0f172a!important}.dark .sticky-end .mat-stroked-button .mat-icon{color:#fff!important}.inventory-grid>div{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}:host{display:block;width:100%;overflow-x:auto}@media (max-width: 768px){.inventory-grid{grid-template-columns:25px 70px 110px 90px 90px 80px 80px 80px 80px 80px 35px}}.full-screen-dialog{max-width:100vw!important;margin:0!important;border-radius:0!important}.full-screen-dialog .mat-dialog-container{padding:0!important;border-radius:0!important}.mat-dialog-content{max-height:65vh!important;overflow-y:auto!important}\n'],encapsulation:2,changeDetection:0})}return r})()}}]);