"use strict";(self.webpackChunkfuse=self.webpackChunkfuse||[]).push([[851],{1073:(I,P,o)=>{o.d(P,{Q:()=>S});var u=o(6814),a=o(6223),c=o(4170),g=o(4516),_=o(617),b=o(2296),e=o(8525),n=o(7700),t=o(9212),r=o(7174),m=o(125),p=o(3680);function h(i,T){1&i&&(t.TgZ(0,"mat-error"),t._uU(1," El nombre del departamento es requerido "),t.qZA())}function f(i,T){1&i&&(t.TgZ(0,"mat-error"),t._uU(1," El nombre debe comenzar con may\xfascula "),t.qZA())}function M(i,T){1&i&&(t.TgZ(0,"mat-error"),t._uU(1," El c\xf3digo es requerido "),t.qZA())}function D(i,T){1&i&&(t.TgZ(0,"mat-error"),t._uU(1," El c\xf3digo debe comenzar con may\xfascula "),t.qZA())}function v(i,T){1&i&&(t.TgZ(0,"mat-error"),t._uU(1," La descripci\xf3n debe comenzar con may\xfascula "),t.qZA())}function A(i,T){if(1&i&&(t.TgZ(0,"mat-option",17),t._uU(1),t.qZA()),2&i){const l=T.$implicit;t.Q6J("value",l.sigla||l.nombre),t.xp6(1),t.hij(" ",l.nombre," ")}}function O(i,T){1&i&&(t.TgZ(0,"mat-error"),t._uU(1," Debe seleccionar un ministerio "),t.qZA())}function U(i,T){1&i&&(t.TgZ(0,"mat-error"),t._uU(1," El nombre del director debe comenzar con may\xfascula "),t.qZA())}function x(i){if(!i.value)return null;const l=i.value.toString().charAt(0);return l!==l.toUpperCase()?{notCapitalized:{value:i.value}}:null}let S=(()=>{class i{constructor(l,d,s,E,C){this.fb=l,this.dialogRef=d,this.data=s,this.catalogService=E,this.entidadService=C,this.ministerios=[],this.entidad=null,this.loading={entidad:!0,ministerios:!0},this.departamentoForm=this.fb.group({nombre:["",[a.kI.required,x]],codigo:["",[a.kI.required,x]],descripcion:["",[x]],ministerio:["",[a.kI.required]],entidad_id:[0],director:["",[x]]})}ngOnInit(){this.entidadService.getLogs().subscribe({next:l=>{console.log("Entidad data:",l),this.loading.entidad=!1,l&&l.success&&l.data?(this.entidad=l.data,this.departamentoForm.patchValue({entidad_id:this.entidad.id})):this.entidad={nombre:"No se encontr\xf3 entidad"}},error:l=>{console.error("Error loading entidad:",l),this.loading.entidad=!1,this.entidad={nombre:"Error al cargar entidad"}}}),this.catalogService.getMinisterios().subscribe({next:l=>{console.log("Ministerios data:",l),this.loading.ministerios=!1;const d=l;this.ministerios=Array.isArray(d)?d:d&&d.success&&Array.isArray(d.data)?d.data:[],console.log("Ministerios procesados:",this.ministerios)},error:l=>{console.error("Error loading ministerios:",l),this.loading.ministerios=!1,this.ministerios=[]}})}onInputChange(l,d){const s=l.target.value;if(s){const E=s.charAt(0).toUpperCase()+s.slice(1);this.departamentoForm.get(d)?.setValue(E,{emitEvent:!1})}}onCancel(){this.dialogRef.close()}onSubmit(){if(this.departamentoForm.valid){const l={...this.departamentoForm.value,id:Math.floor(1e3*Math.random())};this.dialogRef.close(l)}}static#t=this.\u0275fac=function(d){return new(d||i)(t.Y36(a.qu),t.Y36(n.so),t.Y36(n.WI),t.Y36(r.a),t.Y36(m.q))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["app-departamento-form"]],standalone:!0,features:[t.jDz],decls:44,vars:11,consts:[[1,"flex","flex-col","p-6","md:p-8","gap-4"],[1,"text-3xl","font-bold","mb-4"],[1,"flex","flex-col","gap-4",3,"formGroup","ngSubmit"],[1,"grid","grid-cols-1","gap-4"],["appearance","outline"],["matInput","","formControlName","nombre","required","",3,"input"],[4,"ngIf"],["matInput","","formControlName","codigo","required","",3,"input"],["matInput","","formControlName","descripcion","rows","3",3,"input"],["formControlName","ministerio","required",""],["value",""],[3,"value",4,"ngFor","ngForOf"],["matInput","","readonly","",3,"value"],["matInput","","formControlName","director",3,"input"],[1,"flex","justify-end","gap-2","mt-4"],["type","button","mat-stroked-button","",3,"click"],["type","submit","mat-flat-button","","color","primary",3,"disabled"],[3,"value"]],template:function(d,s){if(1&d&&(t.TgZ(0,"div",0)(1,"h2",1),t._uU(2,"Nuevo Departamento"),t.qZA(),t.TgZ(3,"form",2),t.NdJ("ngSubmit",function(){return s.onSubmit()}),t.TgZ(4,"div",3)(5,"mat-form-field",4)(6,"mat-label"),t._uU(7,"Nombre del Departamento"),t.qZA(),t.TgZ(8,"input",5),t.NdJ("input",function(C){return s.onInputChange(C,"nombre")}),t.qZA(),t.YNc(9,h,2,0,"mat-error",6)(10,f,2,0,"mat-error",6),t.qZA(),t.TgZ(11,"mat-form-field",4)(12,"mat-label"),t._uU(13,"C\xf3digo"),t.qZA(),t.TgZ(14,"input",7),t.NdJ("input",function(C){return s.onInputChange(C,"codigo")}),t.qZA(),t.YNc(15,M,2,0,"mat-error",6)(16,D,2,0,"mat-error",6),t.qZA(),t.TgZ(17,"mat-form-field",4)(18,"mat-label"),t._uU(19,"Descripci\xf3n"),t.qZA(),t.TgZ(20,"textarea",8),t.NdJ("input",function(C){return s.onInputChange(C,"descripcion")}),t.qZA(),t.YNc(21,v,2,0,"mat-error",6),t.qZA(),t.TgZ(22,"mat-form-field",4)(23,"mat-label"),t._uU(24,"Ministerio"),t.qZA(),t.TgZ(25,"mat-select",9)(26,"mat-option",10),t._uU(27,"Seleccione un ministerio"),t.qZA(),t.YNc(28,A,2,2,"mat-option",11),t.qZA(),t.YNc(29,O,2,0,"mat-error",6),t.qZA(),t.TgZ(30,"mat-form-field",4)(31,"mat-label"),t._uU(32,"Entidad"),t.qZA(),t._UZ(33,"input",12),t.qZA(),t.TgZ(34,"mat-form-field",4)(35,"mat-label"),t._uU(36,"Director"),t.qZA(),t.TgZ(37,"input",13),t.NdJ("input",function(C){return s.onInputChange(C,"director")}),t.qZA(),t.YNc(38,U,2,0,"mat-error",6),t.qZA()(),t.TgZ(39,"div",14)(40,"button",15),t.NdJ("click",function(){return s.onCancel()}),t._uU(41,"Cancelar"),t.qZA(),t.TgZ(42,"button",16),t._uU(43,"Guardar"),t.qZA()()()()),2&d){let E,C,F,Z,L,y,R;t.xp6(3),t.Q6J("formGroup",s.departamentoForm),t.xp6(6),t.Q6J("ngIf",null==(E=s.departamentoForm.get("nombre"))?null:E.hasError("required")),t.xp6(1),t.Q6J("ngIf",null==(C=s.departamentoForm.get("nombre"))?null:C.hasError("notCapitalized")),t.xp6(5),t.Q6J("ngIf",null==(F=s.departamentoForm.get("codigo"))?null:F.hasError("required")),t.xp6(1),t.Q6J("ngIf",null==(Z=s.departamentoForm.get("codigo"))?null:Z.hasError("notCapitalized")),t.xp6(5),t.Q6J("ngIf",null==(L=s.departamentoForm.get("descripcion"))?null:L.hasError("notCapitalized")),t.xp6(7),t.Q6J("ngForOf",s.ministerios),t.xp6(1),t.Q6J("ngIf",null==(y=s.departamentoForm.get("ministerio"))?null:y.hasError("required")),t.xp6(4),t.Q6J("value",s.loading.entidad?"Cargando entidad...":(null==s.entidad?null:s.entidad.nombre)||"Sin entidad"),t.xp6(5),t.Q6J("ngIf",null==(R=s.departamentoForm.get("director"))?null:R.hasError("notCapitalized")),t.xp6(4),t.Q6J("disabled",!s.departamentoForm.valid)}},dependencies:[u.ez,u.sg,u.O5,a.UX,a._Y,a.Fj,a.JJ,a.JL,a.Q7,a.sg,a.u,c.lN,c.KE,c.hX,c.TO,g.c,g.Nt,b.ot,b.lW,e.LD,e.gD,p.ey,_.Ps],styles:['@charset "UTF-8";.dialog-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;max-height:90vh}.dialog-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:16px 24px 8px;border-bottom:1px solid #e0e0e0;margin-bottom:16px}.dialog-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;color:#333;font-weight:500}.dialog-header[_ngcontent-%COMP%]   .close-button[_ngcontent-%COMP%]{position:relative;top:-8px;right:-8px;color:#666}.dialog-header[_ngcontent-%COMP%]   .close-button[_ngcontent-%COMP%]:hover{background-color:#f5f5f5;color:#333}.dialog-content[_ngcontent-%COMP%]{flex:1;padding:0 24px!important;margin:0!important;overflow-y:auto}.dialog-content[_ngcontent-%COMP%]   .departamento-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.dialog-content[_ngcontent-%COMP%]   .departamento-form[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}.dialog-actions[_ngcontent-%COMP%]{padding:16px 24px!important;margin:0!important;border-top:1px solid #e0e0e0;gap:8px;justify-content:flex-end}.dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:80px}  .custom-dialog-container .mat-mdc-dialog-container{padding:0!important}  .custom-dialog-container .mat-mdc-dialog-title{margin:0!important;padding:0!important}.close-button[_ngcontent-%COMP%]{float:right;top:-24px;right:-24px}.close-icon[_ngcontent-%COMP%]{transition:1s ease-in-out}.close-icon[_ngcontent-%COMP%]:hover{transform:rotate(180deg)}  .icon-outside .close-button{float:right;top:-52px;right:-52px}  .icon-outside .mat-dialog-container{overflow:unset}']})}return i})()},4065:(I,P,o)=>{o.d(P,{_:()=>g});var u=o(2022),a=o(9212),c=o(9862);let g=(()=>{class _{constructor(e){this.http=e,this.baseUrl=u.P.DEPARTAMENTOS}getDepartamentos(){console.log("Fetching departamentos list from backend");const e=this.http.get(this.baseUrl);return e.subscribe(n=>console.log("Response from getDepartamentos:",n)),e}getDepartamentoById(e){console.log(`Fetching departamento with id ${e} from backend`);const n=this.http.get(`${this.baseUrl}/${e}`);return n.subscribe(t=>console.log(`Response from getDepartamentoById(${e}):`,t)),n}createDepartamento(e){console.log("Creating departamento:",e);const n=this.http.post(this.baseUrl,e);return n.subscribe(t=>console.log("Response from createDepartamento:",t)),n}updateDepartamento(e,n){console.log(`Updating departamento with id ${e}:`,n);const t=this.http.put(`${this.baseUrl}/${e}`,n);return t.subscribe(r=>console.log(`Response from updateDepartamento(${e}):`,r)),t}deleteDepartamento(e){console.log(`Deleting departamento with id ${e}`);const n=this.http.delete(`${this.baseUrl}/${e}`);return n.subscribe(()=>console.log(`Response from deleteDepartamento(${e}): success`)),n}static#t=this.\u0275fac=function(n){return new(n||_)(a.LFG(c.eN))};static#e=this.\u0275prov=a.Yz7({token:_,factory:_.\u0275fac,providedIn:"root"})}return _})()},125:(I,P,o)=>{o.d(P,{q:()=>e});var u=o(9397),a=o(6306),c=o(2096),g=o(2022),_=o(9212),b=o(9862);let e=(()=>{class n{constructor(r){this.http=r,this.entidad=[]}getLogs(){return this.http.get(g.P.MI_ENTIDAD).pipe((0,u.b)(r=>console.log("entidad fetched:",r)),(0,a.K)(r=>(console.error("Error fetching contratos:",r),(0,c.of)([...this.entidad]))))}getContratoById(r){return this.http.get(`${g.P.MI_ENTIDAD}/${r}`).pipe((0,a.K)(m=>{console.error("Error fetching contrato by id:",m);const p=this.entidad.find(h=>h.id===r);if(p)return(0,c.of)(p);throw m}))}createContrato(r){return this.http.post(g.P.MI_ENTIDAD,r).pipe((0,a.K)(m=>{console.error("Error creating contrato:",m);const p={...r,id:this.entidad.length};return this.entidad.push(p),(0,c.of)(p)}))}updateContrato(r,m){return this.http.put(`${g.P.MI_ENTIDAD}/${r}`,m).pipe((0,a.K)(p=>{console.error("Error updating contrato:",p);const h=this.entidad.findIndex(f=>f.id===r);if(-1!==h)return this.entidad[h]={...m,id:r},(0,c.of)(this.entidad[h]);throw new Error("Contrato not found")}))}deleteContrato(r){return this.http.delete(`${g.P.MI_ENTIDAD}/${r}`).pipe((0,a.K)(m=>{console.error("Error deleting contrato:",m);const p=this.entidad.findIndex(h=>h.id===r);if(-1!==p)return this.entidad.splice(p,1),(0,c.of)(void 0);throw new Error("Contrato not found")}))}static#t=this.\u0275fac=function(m){return new(m||n)(_.LFG(b.eN))};static#e=this.\u0275prov=_.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})()},7174:(I,P,o)=>{o.d(P,{a:()=>b});var u=o(9397),a=o(553),c=o(2022),g=o(9212),_=o(9862);let b=(()=>{class e{constructor(t){this.http=t,this.baseUrl=a.N.apiUrl}getMinisterios(){return console.log("Calling getMinisterios"),this.http.get(c.P.CATALOGOS.MINISTERIOS).pipe((0,u.b)({next:t=>console.log("getMinisterios response:",t),error:t=>console.error("getMinisterios error:",t)}))}getProvincias(){return console.log("Calling getProvincias"),this.http.get(c.P.CATALOGOS.PROVINCIAS).pipe((0,u.b)({next:t=>console.log("getProvincias response:",t),error:t=>console.error("getProvincias error:",t)}))}getMunicipios(){return console.log("Calling getMunicipios"),this.http.get(c.P.CATALOGOS.MUNICIPIOS).pipe((0,u.b)({next:t=>console.log("getMunicipios response:",t),error:t=>console.error("getMunicipios error:",t)}))}getTiposEmpresa(){return console.log("Calling getTiposEmpresa"),this.http.get(c.P.CATALOGOS.TIPOS_EMPRESA).pipe((0,u.b)({next:t=>console.log("getTiposEmpresa response:",t),error:t=>console.error("getTiposEmpresa error:",t)}))}static#t=this.\u0275fac=function(r){return new(r||e)(g.LFG(_.eN))};static#e=this.\u0275prov=g.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})()},1892:(I,P,o)=>{o.d(P,{T:()=>g});var u=o(1388),a=o(5520),c=o(9212);let g=(()=>{class _{constructor(){}exportToPDF(e,n,t,r){if(!e||0===e.length)return void alert("No hay datos para exportar");const m=new u.ZP({orientation:"landscape",unit:"mm",format:"a4"});if(r){const p=new Image;p.src=r,p.onload=()=>{m.addImage(p,"JPEG",14,10,30,15),this.addPDFContent(m,e,n,t)},p.onerror=()=>{this.addPDFContent(m,e,n,t)}}else this.addPDFContent(m,e,n,t)}addPDFContent(e,n,t,r){e.setFontSize(16),e.setTextColor(40,40,40),e.text(r,50,20),e.setFontSize(10),e.setTextColor(100,100,100),e.text(`Fecha de generaci\xf3n: ${(new Date).toLocaleDateString("es-ES")}`,14,30),e.text(`Total de registros: ${n.length}`,14,35);const m=t.map(f=>f.label),p=n.map(f=>t.map(M=>this.formatValue(f[M.key])));(0,a.ZP)(e,{head:[m],body:p,startY:45,theme:"striped",styles:{fontSize:8,cellPadding:3,overflow:"linebreak",halign:"left"},headStyles:{fillColor:[41,128,185],textColor:[255,255,255],fontStyle:"bold",fontSize:9},margin:{top:45,left:14,right:14,bottom:20},didDrawPage:f=>{const M=e.getNumberOfPages(),D=e.internal.pageSize,v=D.height||D.getHeight();e.setFontSize(8),e.setTextColor(100,100,100),e.text(`P\xe1gina ${f.pageNumber} de ${M}`,14,v-10);const A="Sistema Contratacion",O=e.getTextWidth(A),U=D.width||D.getWidth();e.text(A,U-14-O,v-10)}});const h=`${r.toLowerCase().replace(/\s+/g,"_")}_export_${(new Date).toISOString().split("T")[0]}.pdf`;e.save(h)}exportToExcel(e,n,t){if(!e||0===e.length)return void alert("No hay datos para exportar");const r=[],m=n.map(D=>D.label);r.push(m.join(",")),e.forEach(D=>{const v=n.map(A=>{const O=this.formatValue(D[A.key]);return"string"==typeof O&&(O.includes(",")||O.includes('"'))?`"${O.replace(/"/g,'""')}"`:O});r.push(v.join(","))});const p=r.join("\n"),h=new Blob([p],{type:"text/csv;charset=utf-8;"}),f=window.URL.createObjectURL(h),M=document.createElement("a");M.href=f,M.download=t.endsWith(".csv")?t:`${t}.csv`,M.click(),window.URL.revokeObjectURL(f)}formatValue(e){return null==e?"":e instanceof Date?e.toLocaleDateString("es-ES"):"number"==typeof e?e.toLocaleString("es-ES"):e.toString()}static#t=this.\u0275fac=function(n){return new(n||_)};static#e=this.\u0275prov=c.Yz7({token:_,factory:_.\u0275fac,providedIn:"root"})}return _})()}}]);