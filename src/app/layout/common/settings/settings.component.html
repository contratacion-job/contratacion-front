

<div
    class="settings-cog flex items-center justify-center cursor-pointer print:hidden"
    (click)="settingsDrawer.toggle()">
    <mat-icon
        class="icon-size-5 text-gray animate-spin-slow"
        [svgIcon]="'heroicons_solid:cog-8-tooth'"></mat-icon>
</div>

<fuse-drawer
    class="w-screen min-w-screen sm:w-100 sm:min-w-100 z-999"
    fixed
    [mode]="'over'"
    [name]="'settingsDrawer'"
    [position]="'right'"
    #settingsDrawer>
    <div class="flex flex-col w-full overflow-auto bg-card">
        <div class="flex flex-row items-center px-6 h-20 min-h-20 text-white bg-primary">
            <mat-icon
                class="icon-size-7 text-current"
                [svgIcon]="'heroicons_solid:cog-8-tooth'"></mat-icon>
            <div class="ml-3 text-2xl font-semibold tracking-tight">Configuracion</div>
            <button
                class="ml-auto"
                mat-icon-button
                (click)="settingsDrawer.close()">
                <mat-icon
                    class="text-current"
                    [svgIcon]="'heroicons_outline:x-mark'"></mat-icon>
            </button>
        </div>

        <div class="flex flex-col p-6">

            <!-- Notification -->
            <div *ngIf="showSaveNotification"
                 class="flex items-center p-4 mb-6 bg-green-50 border border-green-200 rounded-lg animate-pulse">
                <mat-icon class="text-green-600 mr-3" [svgIcon]="'heroicons_solid:check-circle'"></mat-icon>
                <span class="text-green-800 font-medium">隆Configuraci贸n guardada exitosamente!</span>
            </div>

            <!-- Theme
            <div class="text-md font-semibold text-secondary">COLOR</div>
            <div class="grid grid-cols-2 sm:grid-cols-3 gap-3 mt-6">
                <ng-container *ngFor="let theme of config.themes">
                    <div
                        class="flex items-center justify-center px-4 py-3 rounded-full cursor-pointer ring-inset ring-primary bg-hover"
                        [class.ring-2]="config.theme === theme.id"
                        [ngClass]="theme.id"
                        (click)="setTheme(theme.id)">
                        <div
                            class="flex-0 w-3 h-3 rounded-full bg-primary"
                        ></div>
                        <div
                            class="ml-2.5 font-medium leading-5 truncate"
                            [class.text-secondary]="config.theme !== theme.id">
                            {{theme.name}}
                        </div>
                    </div>
                </ng-container>
            </div>

            <hr class="my-8">
-->
            <!-- Colores Personalizados -->
            <div class="text-md font-semibold text-secondary">COLORES PERSONALIZADOS</div>
            <div class="grid grid-cols-2 sm:grid-cols-3 gap-3 mt-6">
                <ng-container *ngFor="let colorOption of predefinedColors">
                    <div
                        class="flex items-center justify-center px-4 py-3 rounded-full cursor-pointer ring-inset ring-primary bg-hover"
                        [class.ring-2]="customization.primaryColor === colorOption.color"
                        [style.background-color]="customization.primaryColor === colorOption.color ? colorOption.color + '20' : ''"
                        (click)="setCustomColor(colorOption.color)">
                        <div
                            class="flex-0 w-3 h-3 rounded-full"
                            [style.background-color]="colorOption.color"
                        ></div>
                        <div
                            class="ml-2.5 font-medium leading-5 truncate"
                            [class.text-secondary]="customization.primaryColor !== colorOption.color">
                            {{colorOption.name}}
                        </div>
                    </div>
                </ng-container>
            </div>

            <!-- Color Picker -->
            <div class="mt-4">
                <div
                    class="flex items-center justify-center px-4 py-3 rounded-full cursor-pointer ring-inset ring-primary bg-hover"
                    (click)="colorPicker.click()">
                    <div
                        class="flex-0 w-3 h-3 rounded-full border-2 border-gray-300"
                        [style.background-color]="customization.primaryColor"
                    ></div>
                    <div class="ml-2.5 font-medium leading-5 text-secondary">
                        Color Personalizado
                    </div>
                    <input
                        #colorPicker
                        type="color"
                        class="hidden"
                        [value]="customization.primaryColor"
                        (change)="onCustomColorChange($event)">
                </div>
            </div>

            <div class="mb-6 p-4 border rounded-lg">
                <h3 class="text-lg font-semibold mb-4"> Personalizaci贸n del Sidebar</h3>
                <div class="grid grid-cols-2 md:grid-cols-5 gap-3">
                    <button mat-raised-button color="primary" (click)="testColorChange()" class="bg-red-500">
                         Rojo
                    </button>
                    <button mat-raised-button (click)="testColorBlue()" class="bg-blue-900 text-white">
                         Azul
                    </button>
                    <button mat-raised-button (click)="testColorGreen()" class="bg-green-600 text-white">
                         Verde
                    </button>
                    <button mat-raised-button (click)="testColorPurple()" class="bg-purple-500 text-white">
                         P煤rpura
                    </button>
                    <button mat-raised-button (click)="testColorOrange()" class="bg-orange-600 text-white">
                         Naranja
                    </button>
                </div>
            </div>

            <!-- Scheme -->
            <div class="text-md font-semibold text-secondary">TEMA</div>
            <div class="grid grid-cols-3 gap-3 justify-items-start mt-6">
                <!-- Auto -->
                <div
                    class="flex items-center py-3 pl-5 pr-6 rounded-full cursor-pointer ring-inset ring-primary bg-hover"
                    [class.ring-2]="config.scheme === 'auto'"
                    matTooltip="Automatically sets the scheme based on user's operating system's color scheme preference using 'prefer-color-scheme' media query."
                    (click)="setScheme('auto')">
                    <div class="flex items-center rounded-full overflow-hidden">
                        <mat-icon
                            class="icon-size-5"
                            [svgIcon]="'heroicons_solid:bolt'"></mat-icon>
                    </div>
                    <div
                        class="flex items-center ml-2 font-medium leading-5"
                        [class.text-secondary]="config.scheme !== 'auto'">
                        Auto
                    </div>
                </div>
                <!-- Dark -->
                <div
                    class="flex items-center py-3 pl-5 pr-6 rounded-full cursor-pointer ring-inset ring-primary bg-hover"
                    [class.ring-2]="config.scheme === 'dark'"
                    (click)="setScheme('dark')">
                    <div class="flex items-center rounded-full overflow-hidden">
                        <mat-icon
                            class="icon-size-5"
                            [svgIcon]="'heroicons_solid:moon'"></mat-icon>
                    </div>
                    <div
                        class="flex items-center ml-2 font-medium leading-5"
                        [class.text-secondary]="config.scheme !== 'dark'">
                        Oscuro
                    </div>
                </div>
                <!-- Light -->
                <div
                    class="flex items-center py-3 pl-5 pr-6 rounded-full cursor-pointer ring-inset ring-primary bg-hover"
                    [class.ring-2]="config.scheme === 'light'"
                    (click)="setScheme('light')">
                    <div class="flex items-center rounded-full overflow-hidden">
                        <mat-icon
                            class="icon-size-5"
                            [svgIcon]="'heroicons_solid:sun'"></mat-icon>
                    </div>
                    <div
                        class="flex items-center ml-2 font-medium leading-5"
                        [class.text-secondary]="config.scheme !== 'light'">
                        Claro
                    </div>
                </div>
            </div>

            <!-- Logo -->
            <div class="text-md font-semibold text-secondary">LOGO DE LA EMPRESA</div>

            <!-- Logo Actual -->
            <div class="mt-6 p-4 bg-gray-50 rounded-lg border">
                <div class="text-sm font-medium mb-2">Logo Actual:</div>
                <img [src]="customization.logo"
                     alt="Logo actual"
                     class="h-12 w-auto object-contain"
                     (error)="onImageError($event)">
            </div>

            <!-- Logos Predefinidos -->
            <div class="grid grid-cols-1 gap-3 mt-6">
                <ng-container *ngFor="let logoOption of predefinedLogos">
                    <div
                        class="flex items-center py-3 pl-5 pr-6 rounded-full cursor-pointer ring-inset ring-primary bg-hover"
                        [class.ring-2]="customization.logo === logoOption.path"
                        (click)="setCustomLogo(logoOption.path)">
                        <div class="flex items-center rounded-full overflow-hidden">
                            <img [src]="logoOption.path"
                                 [alt]="logoOption.name"
                                 class="w-5 h-5 object-contain"
                                 (error)="onImageError($event)">
                        </div>
                        <div
                            class="flex items-center ml-2 font-medium leading-5"
                            [class.text-secondary]="customization.logo !== logoOption.path">
                            {{logoOption.name}}
                        </div>
                    </div>
                </ng-container>
            </div>

            <!-- Subir Logo Personalizado -->
            <div class="mt-4">
                <div
                    class="flex items-center py-3 pl-5 pr-6 rounded-full cursor-pointer ring-inset ring-primary bg-hover"
                    (click)="fileInput.click()">
                    <div class="flex items-center rounded-full overflow-hidden">
                        <mat-icon
                            class="icon-size-5"
                            [svgIcon]="'heroicons_solid:cloud-arrow-up'"></mat-icon>
                    </div>
                    <div class="flex items-center ml-2 font-medium leading-5 text-secondary">
                        Subir Logo Personalizado
                    </div>
                    <input
                        #fileInput
                        type="file"
                        accept="image/*"
                        class="hidden"
                        (change)="onLogoUpload($event)">
                </div>
                <div class="text-xs text-secondary mt-2 ml-5">
                    Formatos soportados: JPG, PNG, SVG (m谩ximo 2MB)
                </div>
            </div>

            <hr class="my-8">

            <!-- Nombre de la Empresa -->
            <div class="text-md font-semibold text-secondary">NOMBRE DE LA EMPRESA</div>
            <div class="mt-6">
                <input
                    type="text"
                    class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-primary focus:outline-none transition-colors"
                    placeholder="Nombre de la empresa"
                    [(ngModel)]="customization.companyName"
                    (ngModelChange)="onCompanyNameChange()">
            </div>

            <hr class="my-8">

            <!-- Botones de Acci贸n -->
            <div class="text-md font-semibold text-secondary">ACCIONES</div>
            <div class="grid grid-cols-1 gap-3 mt-6">

                <!-- Bot贸n Guardar Configuraci贸n -->
                <div
                    class="flex items-center py-3 pl-5 pr-6 rounded-full cursor-pointer ring-inset ring-green-500 bg-hover hover:bg-green-50"
                    (click)="saveConfiguration()">
                    <div class="flex items-center rounded-full overflow-hidden">
                        <mat-icon
                            class="icon-size-5 text-green-600"
                            [svgIcon]="'heroicons_solid:bookmark'"></mat-icon>
                    </div>
                    <div class="flex items-center ml-2 font-medium leading-5 text-green-700">
                        Guardar Configuraci贸n
                    </div>
                </div>

                <!-- Bot贸n Aplicar Cambios -->
                <div
                    class="flex items-center py-3 pl-5 pr-6 rounded-full cursor-pointer ring-inset ring-blue-500 bg-hover hover:bg-blue-50"
                    (click)="applyChanges()">
                    <div class="flex items-center rounded-full overflow-hidden">
                        <mat-icon
                            class="icon-size-5 text-blue-600"
                            [svgIcon]="'heroicons_solid:check'"></mat-icon>
                    </div>
                    <div class="flex items-center ml-2 font-medium leading-5 text-blue-700">
                        Aplicar Cambios
                    </div>
                </div>

                <!-- Bot贸n Restablecer -->
                <div
                    class="flex items-center py-3 pl-5 pr-6 rounded-full cursor-pointer ring-inset ring-red-500 bg-hover hover:bg-red-50"
                    (click)="resetCustomization()">
                    <div class="flex items-center rounded-full overflow-hidden">
                        <mat-icon
                            class="icon-size-5 text-red-600"
                            [svgIcon]="'heroicons_solid:arrow-path'"></mat-icon>
                    </div>
                    <div class="flex items-center ml-2 font-medium leading-5 text-red-700">
                        Restablecer
                    </div>
                </div>
            </div>

            <hr class="my-8">

            <!-- Vista Previa de Configuraci贸n -->
            <div class="text-md font-semibold text-secondary">CONFIGURACIN ACTUAL</div>
            <div class="mt-6 p-4 bg-gray-50 rounded-lg">
                <div class="space-y-2 text-sm">
                    <div class="flex justify-between">
                        <strong>Tema:</strong>
                        <span>{{getThemeName(config?.theme || 'theme-default')}}</span>
                    </div>
                    <div class="flex justify-between">
                        <strong>Esquema:</strong>
                        <span>{{config?.scheme || 'light'}}</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <strong>Color Principal:</strong>
                        <div class="flex items-center">
                            <span class="inline-block w-4 h-4 rounded-full">
